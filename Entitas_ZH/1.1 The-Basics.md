# Group

Groups are always up-to-date and contain all entities matching the specified matcher. There is a specific Matcher Type for each context - if you're looking for entities in your Game context (i.e. GameEntities) you'll need to use a GameMatcher.

>组始终是最新的，并包含与指定匹配器匹配的所有实体。 每个上下文都有一个特定的匹配器类型 - 如果您正在寻找游戏上下文中的实体（即 GameEntities），您将需要使用 GameMatcher。

```csharp
var context = contexts.game;

var movables = context.GetGroup(GameMatcher.Movable);
var count = movables.count; // count is 0, the group is empty

var entity1 = context.CreateEntity();
entity1.isMovable = true;
var entity2 = context.CreateEntity();
entity2.IsMovable = true;

count = movables.count; // count is 2, the group contains the entity1 and entity2

// GetEntities() always provides an up to date list
var movableEntities = movables.GetEntities();
foreach (var e in movableEntities) {
    // Do sth
}

entity1.Destroy();
entity2.Destroy();

count = movables.count; // count is 0, the group is empty
```

# Matcher

Matchers are generated by the code generator and can be combined. Matchers are usually used to get groups of entities from the context of interest. Remember to prefix the matcher with the context name you are interested (e.g. GameMatcher, InputMatcher etc). We will use GameMatcher for these examples.

>匹配器由代码生成器生成，并且可以组合。 匹配器通常用于从感兴趣的上下文中获取实体组。 请记住在匹配器前面加上您感兴趣的上下文名称（例如 GameMatcher、InputMatcher 等）。 对于这些示例，我们将使用 GameMatcher。

```csharp
var matcher = GameMatcher.Movable;

GameMatcher.AllOf(GameMatcher.Movable, GameMatcher.Position);

GameMatcher.AnyOf(GameMatcher.Move, GameMatcher.Position);

GameMatcher
    .AllOf(GameMatcher.Position)
    .AnyOf(GameMatcher.Health, GameMatcher.Interactive)
    .NoneOf(GameMatcher.Animating);
```

# Systems

There are 4 different types of Systems:
- **IInitializeSystem:** Executes once (`system.Initialize()`)
- **IExecuteSystem:** Executes every frame (`system.Execute()`)
- **ICleanupSystem:** Executes every frame after the other systems are finished (system.Cleanup())
- **ReactiveSystem:** Executes when the observed group changed (`system.Execute(Entity[])`)

```csharp
public class MoveSystem : IExecuteSystem {
    public void Execute() {
        // Do sth
    }
}

public class CreateLevelSystem : IInitializeSystem {
    public void Initialize() {
        // Do sth
    }
}

public class RenderPositionSystem: ReactiveSystem<GameEntity> {

    public RenderPositionSystem(Contexts contexts) : base(contexts.Game) {
        
    }

    protected override Collector<GameEntity> GetTrigger(IContext<GameEntity> context) {
        return context.CreateCollector(GameMatcher.Position);
    }

    protected override bool Filter(GameEntity entity) {
        // check for required components (here it is position and view)
        return entity.hasPosition && entity.hasView;
    }

    protected override void Execute(List<GameEntity> entities) {
        foreach (var e in entities) {
            // do stuff to the matched entities
            e.view.gameObject.transform.position = e.position.position;
        }
    }
}
```

You can also mix interfaces

```csharp
public class UpdateBoardSystem : IInitializeSystem, ReactiveSystem<GameEntity> {

    Context _context;
    Group _myGroup;

    public UpdateBoardSystem (Contexts contexts) : base(context.game) {
        _context= contexts.game;
        _myGroup = _context.GetGroup(GameMatcher.Xyz);
    }

    public void Initialize() {
        // Do initialization stuff
    }

    protected override Collector<GameEntity> GetTrigger(IContext<GameEntity> context) {
        // define which group we are reacting to
    }

    protected override bool Filter(GameEntity entity) {
        // check for required components
    }

    protected override void Execute(List<GameEntity> entities) {
        foreach (var e in entities) {
            // do stuff to the matched entities
        }
    }
}
```


```csharp

var systems = new Systems(contexts)
    .Add(new CreateLevelSystem(contexts))
    .Add(new UpdateBoardSystem(contexts))
    .Add(new MoveSystem(contexts))
    .Add(new RenderPositionSystem(contexts));

// Call once on start
systems.Initialize();

// Call every frame
systems.Execute();
```

Get inspired by Match-One [GameController.cs](https://github.com/sschmid/Match-One/blob/master/Assets/Features/Game/GameController.cs)

For more detail about systems, including some examples, see [Systems](https://github.com/sschmid/Entitas-CSharp/wiki/Systems)