Foundation of Tool Chains
-   What is Game Engine Tool Chains
	-   Layer Between Users and Engine Runtime
	-   Bridge Between DCC Tools and Game Engine（可以把其他工具导出的数据import成engine识别的资产）
	-   Let Huge Different Mindset Users Work Together（让各种不同思维方式的人一起合作）
-   ﻿﻿Complicated Tool GUI
	-   Immediate Mode
		- 直接调用绘制控件的API
		- 直接简单，可以快速迭代
		- 控件本身不包括任何数据和状态
		- 性能不好
		- 不好扩展
		- ![[Pasted image 20230120182120.png]]
	-   Retained Mode
		- 调用graphics library的API，让这个library去绘制，library内部可以做优化，可以统一处理。如果ui没变化，可以不用去绘制，效率更高。
		- 控件保存有自己的状态和数据
		- 更好的可扩展性，更好的性能
		- 但是对于开发者，编码会比较复杂，需要在gui和logic之间做同步
		- ![[Pasted image 20230120182028.png]]
		- 可以应用设计模式
			- MVC
			- MVP
			- MVVM
-   ﻿﻿How to Load Asset - Deserialization
	- Serialization and Deserialization
		- Serialization is the process of translating a data structure or object state into a format that can be stored (for example, in a file or memory data buffer) or transmitted (for example, over a computer network) and reconstructed later.
		- Deserialization is the opposite operation, extracting a data structure from a series of bytes.
	- Text File
		- 加载比较慢，文件大小比较大，需要加密
		- json
		- yaml
		- xml
		- 需要手动去解析
			- ![[Pasted image 20230120195135.png]]
	- Binary File
		- 加载快，文件大小比较小。
		- ![[Pasted image 20230120195122.png]]
	- Asset reference
		- Assets Reference is a way to separate redundant data into asset files and complete association by establishing reference relationships.(Assets Reference是一种将冗余数据分离到资产文件中，通过建立引用关系完成关联的方式。)
		- 资产去重
	- Object instance in scene
		- Data instance is a way to create a parent data that you can use as a base to make a wide variety of different children and can also be used directly.
		- Build Variance by copying
			- add lots of reduntant data
		- Build Variance by Data Inheritance
			- Data Inheritance: Inherit the data of the inherited object and allow overriding assignments to the data defined in its data structure.
	- Endianness
		- 不同平台大小端不一样
	- Asset Version Compatibility
		- 序列化之后的数据格式需要兼容
		- Solve Compatibility by Version Hardcode
			- Load asset: check if field exists then load data
			- Save asset: write all data to asset file
			- ![[Pasted image 20230120200217.png]]
		- Solve Compatibility by Field UID
			- Google protocol buffers: unique number for field
				- Every field has a unique number, never change the number.
				- Serialization:
					- For every field, generate a “key” (fixed size) according to its field number and type
					- Store field data with key, key is stored in the first few bytes
				- Deserialization:
					- Field not in schema but in data: key would not be recognized, skip the field.
					- Field in schema but not in data: set default value.
-   ﻿﻿How to Make a Robust Tools
	- Undo & Redo
	- Crash Recovery
		- Abstract all user operations to atomic commands which can invoke, revoke and serialize, deserialize.
	- Command （可以用来实现上面两个功能）
		- ![[Pasted image 20230120201521.png]]
		- ICommand provide a basic abstraction of the command
		- Every system (which want to support undo/redo/crash recory ...) needs to implement the system related commands inherantanced from ICommand
		- Command UID
			- Commands need strictly follow the sequence when recovery from disk.
				- Monotonic increase over time
				- Unique identification
		- Command Serialize and Deserialize
			- Provide functions to serialize command instance to data and deserialize data to command instance.
			- TData type needs to provide serialize and deserialize interface
		- Three Key Commands（一般只需要三个命令就可以了）
			- Add
				- Data: Usually data is a copy of the runtime instance
				- Invoke: Create a runtime instance with data
				- Revoke: Delete the runtime instance
			- Delete
				- Data: Usually data is a copy of the runtime instance
				- Invoke: Delete the runtime instance 
				- Revoke: Create a runtime instance with data
			- Update
				- Data: Usually data is the old and new values of the modified properties of the runtime instance and their property names
				- Invoke: Set the runtime instance property to the new value
				- Revoke: Set the runtime instance property to the old value
-   ﻿﻿How to Make Tool Chain
	- Various Tools for Different Users
		- Different viewes for different tools
		- Each tool has it's owner data structure
		- Same data may have different view for different user
	- Develop all Tools Seperately?， 可以，但是不行
	- Find Common Building Blocks，最原子的东西，一个Vector3，一个float等。
	- Schema - A Description Structure（可以简单理解为类）
		- A data schema is the formal description of the structures your system is working with.
		- Standardizing the world description language
			- Unified the data processor
			- Normalized data between different tools（这个schema的数据可以在不同的tool之间流转）
			- Ability to automatically generate standardized UI
		- Schema – Basic Elements
			- Abstraction of the basic building block of the world
				- Atomic Types: Int, Float, Double ...
				- Class Type: Use atomic types to present complex data structure
				- Containers: Array, Map ...
		- Schema – Inheritance
			- Abstraction of the inheritance relationship of the world
		- Schema – Data Reference
			- Abstract of the reference relationship of the world
		- Schema – 2 Definition Ways
			- Standalone schema definition file（proto buffer，根据描述文件自动生成代码）
				- 优点
					- Comprehension easily
					- Low coupling
				- 缺点
					- Ease to mismatch between engine version and schema version 
					- Difficult to define function in the structure 
					- Need to implement complete syntax
			- Defined in code
				- 优点
					- Ease to accomplish Function reflection
					- Natural support for inheritance relationships
				- 缺点
					- Difficult to understand 
					- High coupling
-   ﻿﻿What You See is What You Get  
	- Play in Editor (PIE)（Two implemation ways）
		- Play in editor world: Start gameplay systems tick in editor world and play in it
		- Play in PIE world: Duplicate editor world to create a PIE world and play in it
-   One More Thing - Plugin
	- A software component that adds a specific feature to an existing computer program.
	- PluginManager: Manage plugin loading and unloading. 
	- Interface: A series of abstract classes provided to plug-ins, plug-ins can choose to instantiate different classes to realize the development of corresponding functions. 
	- API: A series of functions exposed by the engine, plug-ins can use functions to execute the logic what we want.
-   ﻿﻿Architecture of A World Editor
	- Editor Viewport : A Special Version of Game Engine
		- Main window of interaction between designers and game world
		- Powered by a full game engine in special “editor” mode
		- Provides a variety of special gadgets and visualizers for editing
		- Editor-only code must be moved out of released game!
	- Everything is an Editable Object
		- The editing requirements of all objects in the editor world are mostly the same, such as moving, adjusting parameters, etc
	- Different Views of Objects
		- Display all of the objects within the scene
		- Organize objects in different views for user conveniences
	- Schema-Driven Object Property Editing
		- Displays all of the editable properties for the selected objects
		- Beyond schema, we can define some customized editing utilities for different types
	- Content Browser
		- Provide intuitive thumbnail of all assets
		- Share asset among different projects
		- Evolution of asset management from static file folder to content “ocean”
	- Editing Utilities in World Editor
		- Mouse Picking
			- Ray Casting 
			- Pros: 
				- No cache required 
				- Can support multiple objects on selected rays 
			- Cons: 
				- Poor query performance
		- RTT 
			- Pros:
				- Easy to implement range queries
				- Ability to complete queries quickly 
			-  Cons: 
				- Need to draw an extra picture
				- Obstructed objects cannot be selected
	- Object Transform Editing
	- Terrain
		- Landform
			- Height map 
		- Appearance 
			- Texture map 
		- Vegetation 
			- Tree instances 
			- Decorator distribution map
		- Height Brush
			- Draw height map to adjust terrain mesh
				- Height change needs to be natural and smooth
				- Can be easily adjusted to the desired results
					- Customized brush
		- Instance Brush
			- Pros:
				- Instance position is fixed
				- Available to further modification
			- Cons:
				- Large amount of data
	- Environment
		- Sky
		- Light
		- Roads
		- Rivers
		- 需求可能经常变化，使用PCG的方式程序生成，定义一套规则，程序根据规则去生成。![[Screen-2023-01-21-105914.mp4]]
		- 定义一个形式化的语言，让设计师去定义规则
-   ﻿﻿Plugin Architecture
	- A Cross Matrix between Systems and Objects
		- Any system and object type could be plug-ins to Editors
	- Combination of Multiple Plugins
		- Covered
			- Only execute the newly registered logic, skip the original logic
			- Ex. Terrain editing overwrite
			- ![[Pasted image 20230121111019.png]]
		- Distributed
			- Each plugin will be executed, and if there is an output, the results will eventually be merged
			- Ex. Most special system editing seperately
			- ![[Pasted image 20230121111031.png]]
		- Pipeline
			- Input and output are connected to each other, generally input and output are the same data type
			- Ex. Asset preprocessing, geometry for physics
			- ![[Pasted image 20230121111040.png]]
		- Onion rings
			- On the basis of the pipeline, the core logic of the system is in the middle, and the plug-in pays attention to the logic of entering and exiting at the same time
			- Ex. Road editing plugin with terrain plugin
			- ![[Pasted image 20230121111050.png]]
	- Version Control
		- A certain version relationship is required between the plug-in and the host application to ensure that they can work together normally.
			- Plug-in use the same version number with the host application
			- Plug-in use the version number of the plug-in interface
				- This is more recommended because the update frequency of the plug-in interface and the software may be different
-   Design Narrative Tools
	- Sequencer
		- Track: In order to reference actors in your sequence. Any character, prop, camera, effect, or other actors can be referenced and manipulated in Sequencer
		- Property Track: Property of reference actors in track
		- Timeline: A line describing time in discrete frames
		- Key Frame: The key fames can manipulate properties. Upon reaching a key frame in the timeline, the track's properties are updated to reflect the values you have defined at that point
		- Sequence: Sequencer's data
	- Sequencer –Bind Objects to Track
		- How to let the sequencer control my “chick”
			- Bind the “chick” to Track
	- Sequencer – Bind Object Property to Property Track
		- How to control the moving position of the “chick”
			- Bind position property to property track
	- Sequencer – Set Key Frame
		- How to make an “chick” reach a specified position
	- Sequencer – Set Key Frames
		- A,B,C,D are key frames. How “chick” go from A to B to C to D
	- Sequencer – Interpolate Properties along Key Frames
		- Similar to animation, set key frames
-   Reflection and Gameplay
	- Reflection is Foundation of Sequencer
		- Any data in game engine can be bind into track based on reflection system
	- 
-   ﻿﻿Collaborative Editing（协同编辑）


